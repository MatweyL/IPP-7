<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <title>Car Control Sercice</title>
</head>
<body>
    <main class="container">
        <h1 class="mt-3">Сервис учета Автомобилей</h1>
        <div class="mt-3">
            <h3>Добавить автомобиль</h3>
            <form class="mt-3">
                <label for="title">Описание</label>
                <input type="text" class="form-control" id="title" placeholder="Enter title" required>
                <label for="brand">Марка</label>
                <input type="text" class="form-control" id="brand" placeholder="Enter brand" required>
                <label for="price">Цена</label>
                <input type="number" class="form-control" id="price" placeholder="Enter price" min="10000" required>
                <label for="age">Возраст</label>
                <input type="number" class="form-control" id="age" placeholder="Enter age" min="0" step="1" required>
                <button class="btn btn-primary" onclick="create_car()">Добавить</button>
            </form>
        </div>
        <div id="listCars" class="mt-3">

        </div>
        <pre><code class="language-json" id="code"></code></pre>
    </main>
 <script>

        function create_car_div(car) {
            let root = document.createElement('div');
            root.className += " card card-body mt-3";
            let id = document.createElement('div');
            let title = document.createElement('div');
            let brand = document.createElement('div');
            let price = document.createElement('div');
            let age = document.createElement('div');
            id.innerText = "id: " + car['id'];
            title.innerText = "Описание: " + car['title'];
            brand.innerText = "Марка: " + car['brand'];
            price.innerText = "Цена: " + car['price'];
            age.innerText = "Возраст: " + car['age'];
            root.appendChild(id);
            root.appendChild(title);
            root.appendChild(brand);
            root.appendChild(price);
            root.appendChild(age);
            return root;
        }


      (async function () {
        const data = JSON.stringify({
          query: `{
            listCars {
            success
            errors
            cars {
                  id
                  title
                  brand
                  price
                  age
              }
            }
          }`,
        });

        const response = await fetch(
          '/graphql',
          {
            method: 'post',
            body: data,
            headers: {
              'Content-Type': 'application/json',
              'Content-Length': data.length
            },
          }
        );

        const json = await response.json();
        let listCars = document.getElementById('listCars');
        let cars_dict = json.data;
        for (let i = 0; i < cars_dict["listCars"]["cars"].length; i++) {
            listCars.appendChild(create_car_div(cars_dict["listCars"]["cars"][i]));
        }
      })();



    function create_car() {
        let title = document.getElementById("title").value;
        let brand = document.getElementById("brand").value;
        let price = document.getElementById("price").value;
        let age = document.getElementById("age").value;
        (async function () {
        const data = JSON.stringify({
          query: `mutation CreateNewCar{
            createCar(
                title: \"${title}\"
                brand: \"${brand}\"
                price: ${price}
                age: ${age}
                ) {
            success
            errors
            }
          }`,
        });

        const response = await fetch(
          '/graphql',
          {
            method: 'post',
            body: data,
            headers: {
              'Content-Type': 'application/json',
              'Content-Length': data.length
            },
          }
        );

        const json = await response.json();
      })();
    }
    </script>
</body>
</html>